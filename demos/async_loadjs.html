<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>异步加载埋点js代码</title>
</head>

<body>
    <script type="text/javascript">
    /**
     * 示例请看控制台
     * 避免多重回调式写法,可灵活配置
     * @type {Array}
     */
    var url_list = [];

    url_list.push('console.js');
    url_list.push('console.js');
    url_list.push('console.js');
    url_list.push('console.js');
    url_list.push('console.js');

    (function load() {
        url_list.length ? loadScript(url_list.shift(), load) : console.log('complete');
    })();

    /*loadScript('console.js', function() {
        loadScript('console.js', function() {
            loadScript('console.js', function() {
                loadScript('console.js', function() {
                    loadScript('console.js', function() {
                        loadScript('console.js', function() {
                            loadScript('console.js', function() {
                            });
                        });
                    });
                });
            });
        });
    });*/

    console.log('asyn');

    //检测加载js时会不会阻塞页面事件
    //异步请求js文件不会阻塞页面事件
    //js文件的执行会阻塞
    document.onclick = alert.bind(null, 1);

    function loadScript(url, callback) {
        var script = document.createElement("script");
        script.type = "text/javascript";
        if (script.readyState) { //IE
            script.onreadystatechange = function() {
                if (script.readyState == "loaded" || script.readyState == "complete") {
                    script.onreadystatechange = null;
                    callback();
                }
            };
        } else { //Others
            script.onload = function() {
                callback();
            };
        }
        script.src = url;
        document.getElementsByTagName("head")[0].appendChild(script);
    }
    </script>
    <script type="text/javascript" src="showcode.js"></script>
</body>

</html>
